<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Examples &mdash; omnifit v0.1.1b</title>
    
    <link rel="stylesheet" href="_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1.1b',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/sidebar.js"></script>
    <link rel="shortcut icon" href="_static/astropy_logo.ico"/>
    <link rel="top" title="omnifit v0.1.1b" href="index.html" />
    <link rel="next" title="AbsorptionSpectrum" href="api/omnifit.spectrum.AbsorptionSpectrum.html" />
    <link rel="prev" title="Installation" href="installation.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="_static/copybutton.js"></script>


  </head>
  <body role="document">
<div class="topbar">
  <a class="brand" title="Documentation Home" href="index.html"><span id="logotext1">astro</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="genindex.html">Index</a></li>
    <li><a title="Module Index" href="py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="api/omnifit.spectrum.AbsorptionSpectrum.html" title="AbsorptionSpectrum">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="installation.html" title="Installation">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="index.html">omnifit v0.1.1b</a>
	 &raquo;
      </li>
      
      <li>Examples</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="examples">
<h1>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h1>
<p>This page lists examples of likely ways to make use of Omnifit.</p>
<div class="section" id="fitting-from-start-to-finish">
<h2>Fitting from start to finish<a class="headerlink" href="#fitting-from-start-to-finish" title="Permalink to this headline">¶</a></h2>
<p>The code snippet below shows how one might go about fitting a target spectrum with an empirically acquired spectrum and a Gaussian function, and the both export the raw fit results and plot them.</p>
<p>The target spectrum data is assumed to originate from a file which consists of two columns of data. The first column contains the wavelength and the second column contains the optical depth of an observed spectrum.</p>
<p>The empirical spectrum being fitted to this, by contrast, is assumed to be a file containing set of data describing the complex refractive index of an ice. The first column of this file contains the frequency of the spectrum (in reciprocal wavenumbers), and the second and third columns containing the real and imaginary parts of the complex refractive index.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">omnifit.spectrum</span> <span class="kn">import</span> <span class="n">AbsorptionSpectrum</span><span class="p">,</span><span class="n">CDEspectrum</span>
<span class="kn">from</span> <span class="nn">omnifit.utils</span> <span class="kn">import</span> <span class="n">unit_od</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="kn">as</span> <span class="nn">u</span>
<span class="kn">from</span> <span class="nn">omnifit.fitter</span> <span class="kn">import</span> <span class="n">Fitter</span>
<span class="kn">from</span> <span class="nn">lmfit</span> <span class="kn">import</span> <span class="n">Parameters</span>
<span class="n">obs_wl</span><span class="p">,</span><span class="n">obs_od</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">&#39;./obsdata.dat&#39;</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span><span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">lab_wn</span><span class="p">,</span><span class="n">lab_n</span><span class="p">,</span><span class="n">lab_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">&#39;./labdata.dat&#39;</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span><span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">obs_spec</span> <span class="o">=</span> <span class="n">AbsorptionSpectrum</span><span class="p">(</span><span class="n">obs_wl</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">micron</span><span class="p">,</span><span class="n">obs_od</span><span class="o">*</span><span class="n">unit_od</span><span class="p">,</span><span class="n">specname</span><span class="o">=</span><span class="s">&#39;Observed data&#39;</span><span class="p">)</span>
<span class="n">lab_spec</span> <span class="o">=</span> <span class="n">CDESpectrum</span><span class="p">(</span><span class="n">lab_wn</span><span class="p">,</span><span class="n">lab_n</span><span class="p">,</span><span class="n">lab_k</span><span class="p">,</span><span class="n">specname</span><span class="o">=</span><span class="s">&#39;Laboratory data&#39;</span><span class="p">)</span>
<span class="n">interp_lab</span> <span class="o">=</span> <span class="n">lab_spec</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">obs_spec</span><span class="p">)</span>
<span class="n">fitter_example</span> <span class="o">=</span> <span class="n">Fitter</span><span class="o">.</span><span class="n">fromspectrum</span><span class="p">(</span><span class="n">obs_spec</span><span class="p">,</span><span class="n">modelname</span><span class="o">=</span><span class="s">&#39;Example fit&#39;</span><span class="p">)</span>
<span class="n">lab_par</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">()</span>
<span class="n">lab_par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;mul&#39;</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">fitter_example</span><span class="o">.</span><span class="n">add_empirical</span><span class="p">(</span><span class="n">interp_lab</span><span class="p">,</span><span class="n">lab_par</span><span class="p">,</span><span class="n">funcname</span><span class="o">=</span><span class="s">&#39;Example empirical function&#39;</span><span class="p">)</span>
<span class="n">theory_par</span><span class="o">=</span><span class="n">Parameters</span><span class="p">()</span>
<span class="n">theory_par</span><span class="o">.</span><span class="n">add_many</span><span class="p">((</span><span class="s">&#39;peak&#39;</span><span class="p">,</span>  <span class="mf">2.5</span><span class="p">,</span>   <span class="bp">True</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>        <span class="bp">None</span><span class="p">,</span>       <span class="bp">None</span><span class="p">),</span>
                    <span class="p">(</span><span class="s">&#39;pos&#39;</span><span class="p">,</span>   <span class="mf">3000.</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mf">3000.</span><span class="o">-</span><span class="mf">200.</span><span class="p">,</span> <span class="mf">3000.</span><span class="o">+</span><span class="mf">200.</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
                    <span class="p">(</span><span class="s">&#39;fwhm&#39;</span><span class="p">,</span>  <span class="mf">50.0</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>        <span class="bp">None</span><span class="p">,</span>       <span class="bp">None</span><span class="p">))</span>
<span class="n">fitter_example</span><span class="o">.</span><span class="n">add_analytical</span><span class="p">(</span><span class="s">&#39;gaussian&#39;</span><span class="p">,</span><span class="n">theory_par</span><span class="p">,</span><span class="n">funcname</span><span class="o">=</span><span class="s">&#39;Example gaussian&#39;</span><span class="p">)</span>
<span class="n">fitter_example</span><span class="o">.</span><span class="n">perform_fit</span><span class="p">()</span>
<span class="n">fitter_example</span><span class="o">.</span><span class="n">fitresults_tofile</span><span class="p">(</span><span class="s">&#39;example_fitres&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">fitter_example</span><span class="o">.</span><span class="n">plot_fitresults</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;example_fitres.pdf&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>In this, line 1-6 import the various components needed for the full fit.
Lines 7 and 8 read the spectrum data from the two files which contain the target spectrum and the complex refractive index spectrum.</p>
<p>Line 9 initialises the target spectrum as an absorption spectrum using the data read in line 7, and line 10 initialises the CDE-corrected spectrum using the data read in line 8.</p>
<p>Line 11 interpolates the data in the CDE-corrected spectrum to match the spectral resolution of the fitting target spectrum, which is also used to initialise the fitter on line 12.</p>
<p>Lines 13 and 14 prepare the fitting parameters for an empirical data, containing only an initial guess (0.5) for the best-fit multiplier. These parameters and the data to be fitted are then given to the fitter on line 15.</p>
<p>Similarly lines 16-19 involve setting up the initial guess and constrains on the parameters for a Gaussian fit, which are then given to the fitter (with instruction to try and fit a Gaussian) on line 20.</p>
<p>Line 21 is used to make the fitting itself happen. After it is done, the command on line 22 can be called to produce two files, example_fitres.csv and example_fitres.xml, which contain all the information on the fit results, as documented in <a class="reference internal" href="api/omnifit.fitter.Fitter.html#omnifit.fitter.Fitter.fitresults_tofile" title="omnifit.fitter.Fitter.fitresults_tofile"><code class="xref py py-obj docutils literal"><span class="pre">omnifit.fitter.Fitter.fitresults_tofile</span></code></a>.</p>
<p>Finally, lines 23-26 are used to produce a plot of the fit results in the file example_fitres.pdf.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Examples</a><ul>
<li><a class="reference internal" href="#fitting-from-start-to-finish">Fitting from start to finish</a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="http://github.com/RiceMunk/omnifit/tree/v0.1.1b/docs/examples.rst">Edit This Page on Github</a> &nbsp;
    <a href="_sources/examples.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2015, Aleksi Suutarinen.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1. &nbsp;
    Last built 08 Sep 2015. <br/>
  </p>
</footer>
  </body>
</html>