<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>omnifit.spectrum.spectrum &mdash; omnifit v0.1.dev35</title>
    
    <link rel="stylesheet" href="../../../_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1.dev35',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../../../_static/astropy_logo.ico"/>
    <link rel="top" title="omnifit v0.1.dev35" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="../../../_static/copybutton.js"></script>


  </head>
  <body role="document">
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../index.html"><span id="logotext1">astro</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../../../index.html">omnifit v0.1.dev35</a>
	 &raquo;
      </li>
      <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for omnifit.spectrum.spectrum</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">convolution</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="k">def</span> <span class="nf">clonable</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
  <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">clone</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;clone&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
      <span class="n">clone</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">clone</span><span class="p">:</span>
      <span class="n">newclass</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
      <span class="n">retdata</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">newclass</span><span class="p">,</span><span class="n">func</span><span class="o">.</span><span class="n">__name__</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">retdata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">newclass</span><span class="p">,</span><span class="n">retdata</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">newclass</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">retdata</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">retdata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">retdata</span>
  <span class="k">return</span> <span class="n">wrapper</span>

<div class="viewcode-block" id="BaseSpectrum"><a class="viewcode-back" href="../../../api/omnifit.spectrum.BaseSpectrum.html#omnifit.spectrum.BaseSpectrum">[docs]</a><span class="k">class</span> <span class="nc">BaseSpectrum</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  A class to represent spectroscopic data.</span>
<span class="sd">  </span>
<span class="sd">  This class is designed to work for spectroscopic data of ices, but </span>
<span class="sd">  may work for other types of spectroscopic data as well.</span>
<span class="sd">  This is the most basic version of the class, concerned solely with</span>
<span class="sd">  the contents of the x and y attributes.</span>

<span class="sd">  Attributes</span>
<span class="sd">  ----------</span>
<span class="sd">  x : `astropy.units.Quantity`</span>
<span class="sd">    Represents the data on the &quot;x-axis&quot; of the spectrum,</span>
<span class="sd">    i.e. usually the wavelength or frequency</span>
<span class="sd">  y : `astropy.units.Quantity`</span>
<span class="sd">    Represents the data on the &quot;x-axis&quot; of the spectrum,</span>
<span class="sd">    i.e. the flux or optical depth</span>
<span class="sd">  dy : `NoneType` or `float`</span>
<span class="sd">    The uncertainty of y. Can be given during initialisation,</span>
<span class="sd">    or automatically calculated during baselining. (default=None)</span>
<span class="sd">  specname : `string`</span>
<span class="sd">    The name of the spectrum (default=&#39;Unknown spectrum&#39;)</span>
<span class="sd">  baselined : `bool`</span>
<span class="sd">    Indicates whether the spectrum has been baselined or not</span>
<span class="sd">  convolved : `bool`</span>
<span class="sd">    Indicates whether the spectrum has been put through convolution</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">dy</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">specname</span><span class="o">=</span><span class="s">&#39;Unknown spectrum&#39;</span><span class="p">,</span><span class="n">nondata</span><span class="o">=</span><span class="p">[]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    BaseSpectrum(x,y,dy=None,specname=&#39;Unknown spectrum&#39;,nondata=[])</span>

<span class="sd">    Constructor for the BaseSpectrum class. Requires x and y;</span>
<span class="sd">    everything else is optional.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : `astropy.units.Quantity` or `numpy.ndarray`</span>
<span class="sd">      Represents the data on the &quot;x-axis&quot; of the spectrum.</span>
<span class="sd">      This is stored as an astropy quantity and thus it is</span>
<span class="sd">      recommended that the class constructor is called with</span>
<span class="sd">      such an input. However, the constructor also accepts</span>
<span class="sd">      a numpy ndarray, in which case it will try to guess</span>
<span class="sd">      the units and then convert the input into an appropriate</span>
<span class="sd">      astropy quantity.</span>
<span class="sd">      The autodetection assumes the units are in kayser units</span>
<span class="sd">      (i.e. reciprocal wavenumbers with the unit cm^-1) if the</span>
<span class="sd">      mean of the input array is greater than 1000. Otherwise</span>
<span class="sd">      the autodetection assumes the units are in microns.</span>
<span class="sd">    y : `astropy.units.Quantity` or `numpy.ndarray`</span>
<span class="sd">      Represents the data on the &quot;x-axis&quot; of the spectrum.</span>
<span class="sd">      This is stored as an astropy quantity and thus it is</span>
<span class="sd">      recommended that the class constructor is called with</span>
<span class="sd">      such an input. However, the constructor also accepts</span>
<span class="sd">      a numpy ndarray, in which case it will assume that</span>
<span class="sd">      the units are in optical depth and then convert the </span>
<span class="sd">      input into this astropy quantity.</span>
<span class="sd">    dy : `float`, optional</span>
<span class="sd">      The uncertainty of y. If given, this is assumed to be</span>
<span class="sd">      the uncertainty of the y axis data in the same units</span>
<span class="sd">      as given (or assumed) with the y input. Otherwise</span>
<span class="sd">      the uncertainty is left as None during initialisation</span>
<span class="sd">      and will be calculated as part of baselining.</span>
<span class="sd">    specname : `string`, optional</span>
<span class="sd">      An optional human-readable name can be given to the</span>
<span class="sd">      spectrum via this input.</span>
<span class="sd">    nondata : `list`, optional</span>
<span class="sd">      If information unrelated to the x and y input data is</span>
<span class="sd">      stored in the class instance, the variable names in which</span>
<span class="sd">      this information is stored can be given here. This causes</span>
<span class="sd">      various internal functions (related to automatic sorting </span>
<span class="sd">      and error-checking) of the class to ignore these</span>
<span class="sd">      variables.</span>
<span class="sd">      It is not usually necessary for the user to use this input</span>
<span class="sd">      during initialisation; it is most often used by children of</span>
<span class="sd">      the BaseSpectrum class.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>                                  <span class="c">#Check that input is sane</span>
      <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Input arrays have different sizes.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="n">u</span><span class="o">.</span><span class="n">quantity</span><span class="o">.</span><span class="n">Quantity</span><span class="p">:</span>
      <span class="c">#try to guess x units (between micron and kayser; the most common units) if none given</span>
      <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1000.</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&#39;The x data is not in astropy unit format. Autodetection assumes kayser.&#39;</span><span class="p">,</span><span class="ne">RuntimeWarning</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kayser</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&#39;The x data is not in astropy unit format. Autodetection assumes micron.&#39;</span><span class="p">,</span><span class="ne">RuntimeWarning</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">micron</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">=</span><span class="n">x</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="n">u</span><span class="o">.</span><span class="n">quantity</span><span class="o">.</span><span class="n">Quantity</span><span class="p">:</span>
      <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&#39;The y data is not in astropy unit format. Assuming optical depth.&#39;</span><span class="p">,</span><span class="ne">RuntimeWarning</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="o">*</span><span class="n">utils</span><span class="o">.</span><span class="n">unit_od</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="n">y</span>
    <span class="k">if</span> <span class="n">dy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">dy</span><span class="o">=</span><span class="n">dy</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">dy</span><span class="o">=</span><span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">specname</span><span class="p">)</span>                                 <span class="c">#Spectrum name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">baselined</span><span class="o">=</span><span class="bp">False</span>                                    <span class="c">#Has the spectrum been baselined?</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">convolved</span><span class="o">=</span><span class="bp">False</span>                                    <span class="c">#Has the spectrum been convolved?</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__nondata</span> <span class="o">=</span> <span class="p">[</span>
                      <span class="s">&#39;_BaseSpectrum__nondata&#39;</span><span class="p">,</span>\
                      <span class="s">&#39;name&#39;</span><span class="p">,</span>\
                      <span class="s">&#39;convolved&#39;</span><span class="p">,</span><span class="s">&#39;baselined&#39;</span><span class="p">,</span>\
                      <span class="s">&#39;dy&#39;</span>\
                   <span class="p">]</span>
    <span class="k">for</span> <span class="n">cnondata</span> <span class="ow">in</span> <span class="n">nondata</span><span class="p">:</span>                                <span class="c">#Add the extra non-array variable names into nondata</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">cnondata</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__nondata</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__nondata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cnondata</span><span class="p">)</span>                       
    <span class="bp">self</span><span class="o">.</span><span class="n">__fixbad</span><span class="p">()</span>                                          <span class="c">#Drop bad data.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__sort</span><span class="p">()</span>
  <span class="k">def</span> <span class="nf">__sort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    __sort()</span>

<span class="sd">    An internal method which sorts the data arrays so that they</span>
<span class="sd">    all go in increasing order of x.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sorter</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
    <span class="n">nondatavars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__nondata</span>
    <span class="n">ownvarnames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="n">ownvarnames</span> <span class="o">=</span> <span class="nb">filter</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="ow">not</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">nondatavars</span><span class="p">,</span> <span class="n">ownvarnames</span><span class="p">)</span>
    <span class="n">varlength</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">ownvarnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">iGoodones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">varlength</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">cVarname</span> <span class="ow">in</span> <span class="n">ownvarnames</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">cVarname</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">cVarname</span><span class="p">][</span><span class="n">sorter</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">__fixbad</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    __fixbad()</span>

<span class="sd">    An internal method which replaces all non-number data (e.g. </span>
<span class="sd">    infinities) in the data arrays with `numpy.nan`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ignorevars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__nondata</span>
    <span class="n">ownvarnames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="n">ownvarnames</span> <span class="o">=</span> <span class="nb">filter</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignorevars</span><span class="p">,</span> <span class="n">ownvarnames</span><span class="p">)</span>
    <span class="n">varlength</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">ownvarnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">iGoodones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">varlength</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">cVarname</span> <span class="ow">in</span> <span class="n">ownvarnames</span><span class="p">:</span>
      <span class="n">cVar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">cVarname</span><span class="p">]</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cVar</span><span class="p">)</span> <span class="o">!=</span> <span class="n">varlength</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Anomalous variable length detected in spectrum!&#39;</span><span class="p">)</span>
      <span class="n">iGoodones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">iGoodones</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">cVar</span><span class="p">))</span>
    <span class="n">iBadones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">iGoodones</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">cVarname</span> <span class="ow">in</span> <span class="n">ownvarnames</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">cVarname</span> <span class="o">!=</span> <span class="s">&#39;x&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">cVarname</span><span class="p">][</span><span class="n">iBadones</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<div class="viewcode-block" id="BaseSpectrum.plot"><a class="viewcode-back" href="../../../api/omnifit.spectrum.BaseSpectrum.html#omnifit.spectrum.BaseSpectrum.plot">[docs]</a>  <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axis</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s">&#39;y&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plot(axis,x=&#39;x&#39;,y=&#39;y&#39;,**kwargs)</span>

<span class="sd">    Plot the contents of the spectrum into a given matplotlib axis.</span>
<span class="sd">    Defaults to the data contained in the x and y attributes, but</span>
<span class="sd">    can also plot other data content if instructed to do so.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    axis : `matplotlib.axis`</span>
<span class="sd">      The axis which the plot will be generated in.</span>
<span class="sd">    x : `string`, optional</span>
<span class="sd">      The name of the variable to be plotted on the x axis.</span>
<span class="sd">    y : `string`, optional</span>
<span class="sd">      The name of the variable to be plotted on the x axis.</span>
<span class="sd">    **kwargs : Arguments, optional</span>
<span class="sd">      This can be used to pass additional arguments</span>
<span class="sd">      to `matplotlib.pyplot.plot`, which is used by this </span>
<span class="sd">      method for its plotting.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span> <span class="c">#assume it&#39;s with astropy units</span>
      <span class="n">plotx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
      <span class="n">plotx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span> <span class="c">#assume it&#39;s with astropy units</span>
      <span class="n">ploty</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
      <span class="n">ploty</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">y</span><span class="p">]</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">plotx</span><span class="p">,</span><span class="n">ploty</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
  <span class="nd">@clonable</span>
<div class="viewcode-block" id="BaseSpectrum.convert2wn"><a class="viewcode-back" href="../../../api/omnifit.spectrum.BaseSpectrum.html#omnifit.spectrum.BaseSpectrum.convert2wn">[docs]</a>  <span class="k">def</span> <span class="nf">convert2wn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    convert2wn(clone=False)</span>

<span class="sd">    Convert the x axis data to kayser (reciprocal wavenumber) units.</span>
<span class="sd">    Re-sort the data afterwards.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    clone : `bool`, optional</span>
<span class="sd">      If set to True, returns a modified copy of the spectrum instead</span>
<span class="sd">      of operating on the existing spectrum.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">convert2</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">kayser</span><span class="p">)</span>
</div>
  <span class="nd">@clonable</span>
<div class="viewcode-block" id="BaseSpectrum.convert2wl"><a class="viewcode-back" href="../../../api/omnifit.spectrum.BaseSpectrum.html#omnifit.spectrum.BaseSpectrum.convert2wl">[docs]</a>  <span class="k">def</span> <span class="nf">convert2wl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    convert2wl(clone=False)</span>

<span class="sd">    Convert the x axis data to wavelength (in microns) units.</span>
<span class="sd">    Re-sort the data afterwards.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    clone : `bool`, optional</span>
<span class="sd">      If set to True, returns a modified copy of the spectrum instead</span>
<span class="sd">      of operating on the existing spectrum.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">convert2</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">micron</span><span class="p">)</span>
</div>
  <span class="nd">@clonable</span>
<div class="viewcode-block" id="BaseSpectrum.convert2"><a class="viewcode-back" href="../../../api/omnifit.spectrum.BaseSpectrum.html#omnifit.spectrum.BaseSpectrum.convert2">[docs]</a>  <span class="k">def</span> <span class="nf">convert2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">newunit</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    convert2(newunit,clone=False)</span>

<span class="sd">    Convert the x axis data to given spectral units.</span>
<span class="sd">    Re-sort the data afterwards.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    newunit : `astropy.units.core.Unit`</span>
<span class="sd">      Desired (spectral) unit the x axis data should be</span>
<span class="sd">      converted to.</span>
<span class="sd">    clone : `bool`, optional</span>
<span class="sd">      If set to True, returns a modified copy of the spectrum instead</span>
<span class="sd">      of operating on the existing spectrum.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">u</span><span class="o">.</span><span class="n">set_enabled_equivalencies</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">equivalencies</span><span class="o">.</span><span class="n">spectral</span><span class="p">()):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">newunit</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__sort</span><span class="p">()</span>
</div>
  <span class="nd">@clonable</span>
<div class="viewcode-block" id="BaseSpectrum.subspectrum"><a class="viewcode-back" href="../../../api/omnifit.spectrum.BaseSpectrum.html#omnifit.spectrum.BaseSpectrum.subspectrum">[docs]</a>  <span class="k">def</span> <span class="nf">subspectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">limit_lower</span><span class="p">,</span><span class="n">limit_upper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    subspectrum(limit_lower,limit_upper,clone=False)</span>

<span class="sd">    Cropped the spectrum along along the x axis using the given</span>
<span class="sd">    inclusive limits.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    limit_lower : `float`</span>
<span class="sd">      The desired minimum x axis of the cropped spectrum, in</span>
<span class="sd">      current units of the spectrum. This limit is inclusive.</span>
<span class="sd">    limit_upper : `float`</span>
<span class="sd">      The desired maximum x axis of the cropped spectrum, in</span>
<span class="sd">      current units of the spectrum. This limit is inclusive.</span>
<span class="sd">    clone : `bool`, optional</span>
<span class="sd">      If set to True, returns a modified copy of the spectrum instead</span>
<span class="sd">      of operating on the existing spectrum.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">iSub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">greater_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">limit_lower</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">less_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">limit_upper</span><span class="p">))</span>
    <span class="n">newX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">iSub</span><span class="p">]</span>
    <span class="n">newY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">iSub</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">newX</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">newY</span>
</div>
  <span class="nd">@clonable</span>
<div class="viewcode-block" id="BaseSpectrum.interpolate"><a class="viewcode-back" href="../../../api/omnifit.spectrum.BaseSpectrum.html#omnifit.spectrum.BaseSpectrum.interpolate">[docs]</a>  <span class="k">def</span> <span class="nf">interpolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">target_spectrum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    interpolate(target_spectrum,clone=False)</span>

<span class="sd">    Interpolate spectrum to match target spectrum resolution.</span>
<span class="sd">    Does not modify current spectrum, but returns a new one, which is</span>
<span class="sd">    a copy of the current spectrum but with the interpolated data on</span>
<span class="sd">    the x and y fields.</span>
<span class="sd">    The target spectrum has to be using the same units on the x and</span>
<span class="sd">    y axes as the current spectrum, or the interpolation will fail.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    target_spectrum : `BaseSpectrum`</span>
<span class="sd">      The target spectrum which the x axis resolution of the current</span>
<span class="sd">      spectrum should be made to match.</span>
<span class="sd">    clone : `bool`, optional</span>
<span class="sd">      If set to True, returns a modified copy of the spectrum instead</span>
<span class="sd">      of operating on the existing spectrum.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">unit</span> <span class="o">!=</span> <span class="n">target_spectrum</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">unit</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">u</span><span class="o">.</span><span class="n">UnitsError</span><span class="p">(</span><span class="s">&#39;Spectrums have different units on x axis!&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">unit</span> <span class="o">!=</span> <span class="n">target_spectrum</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">unit</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">u</span><span class="o">.</span><span class="n">UnitsError</span><span class="p">(</span><span class="s">&#39;Spectrums have different units on y axis!&#39;</span><span class="p">)</span>
    <span class="n">newX</span><span class="o">=</span><span class="n">target_spectrum</span><span class="o">.</span><span class="n">x</span>
    <span class="n">newY</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">newX</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">newX</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">newY</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s">&#39;(interpolated: &#39;</span><span class="o">+</span><span class="n">target_spectrum</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s">&#39;)&#39;</span>
</div>
<div class="viewcode-block" id="BaseSpectrum.yat"><a class="viewcode-back" href="../../../api/omnifit.spectrum.BaseSpectrum.html#omnifit.spectrum.BaseSpectrum.yat">[docs]</a>  <span class="k">def</span> <span class="nf">yat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    yat(x)</span>

<span class="sd">    Return interpolated value of y at requested x.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : `float`</span>
<span class="sd">      The x axis coordinate of interest.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    The interpolated value of y at the requested x coordinate.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</div>
  <span class="nd">@clonable</span>
<div class="viewcode-block" id="BaseSpectrum.convolve"><a class="viewcode-back" href="../../../api/omnifit.spectrum.BaseSpectrum.html#omnifit.spectrum.BaseSpectrum.convolve">[docs]</a>  <span class="k">def</span> <span class="nf">convolve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kernel</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    convolve(kernel,clone=False,**kwargs)</span>

<span class="sd">    Use `astropy.convolution.convolve` to convolve the y axis data of the</span>
<span class="sd">    spectrum with the given kernel.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    kernel : `numpy.ndarray` or `astropy.convolution.Kernel`</span>
<span class="sd">      A convolution kernel to feed into the convolution function.</span>
<span class="sd">    clone : `bool`, optional</span>
<span class="sd">      If set to True, returns a modified copy of the spectrum instead</span>
<span class="sd">      of operating on the existing spectrum.</span>
<span class="sd">    **kwargs : Arguments, optional</span>
<span class="sd">      This can be used to pass additional arguments</span>
<span class="sd">      to `astropy.convolution.convolve`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">convolved</span><span class="p">:</span>
      <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&#39;Spectrum &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s">&#39; has already been convolved once!&#39;</span><span class="p">,</span><span class="ne">RuntimeWarning</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="n">convolution</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">kernel</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">convolved</span><span class="o">=</span><span class="bp">True</span>
</div>
  <span class="nd">@clonable</span>
<div class="viewcode-block" id="BaseSpectrum.gconvolve"><a class="viewcode-back" href="../../../api/omnifit.spectrum.BaseSpectrum.html#omnifit.spectrum.BaseSpectrum.gconvolve">[docs]</a>  <span class="k">def</span> <span class="nf">gconvolve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fwhm</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    gconvolve(fwhm,**kwargs)</span>

<span class="sd">    Convolve spectrum using a gaussian of given fwhm.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fwhm : `float`</span>
<span class="sd">      The desired fwhm of the gaussian, in units of x axis.</span>
<span class="sd">    **kwargs : Arguments, optional</span>
<span class="sd">      This can be used to pass additional arguments</span>
<span class="sd">      to `convolve`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gkernel</span><span class="o">=</span><span class="n">convolution</span><span class="o">.</span><span class="n">Gaussian1DKernel</span><span class="p">(</span><span class="n">fwhm</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">gkernel</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
  <span class="nd">@clonable</span>
<div class="viewcode-block" id="BaseSpectrum.smooth"><a class="viewcode-back" href="../../../api/omnifit.spectrum.BaseSpectrum.html#omnifit.spectrum.BaseSpectrum.smooth">[docs]</a>  <span class="k">def</span> <span class="nf">smooth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">window_len</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span><span class="n">window</span><span class="o">=</span><span class="s">&#39;hanning&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    smooth(window_len=11,window=&#39;hanning&#39;,clone=False)</span>

<span class="sd">    Smooth the spectrum using the given window of requested type and size.</span>
<span class="sd">    The supported smoothing functions are: Bartlett, Blackman, Hanning,</span>
<span class="sd">    Hamming, and flat (i.e. moving average).</span>
<span class="sd">    This method has been adapted from http://stackoverflow.com/a/5516430</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    window_len : `int`, optional</span>
<span class="sd">      Desired window size, in increments of x axis.</span>
<span class="sd">    window : {&#39;flat&#39;,&#39;hanning&#39;,&#39;hamming&#39;,&#39;bartlett&#39;,&#39;blackman&#39;}, optional</span>
<span class="sd">      Desired window type.</span>
<span class="sd">    clone : `bool`, optional</span>
<span class="sd">      If set to True, returns a modified copy of the spectrum instead</span>
<span class="sd">      of operating on the existing spectrum.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="s">&quot;smooth only accepts 1 dimension arrays.&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="n">window_len</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="s">&quot;Input vector needs to be bigger than window size.&quot;</span>
    <span class="k">if</span> <span class="n">window_len</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">window</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;flat&#39;</span><span class="p">,</span> <span class="s">&#39;hanning&#39;</span><span class="p">,</span> <span class="s">&#39;hamming&#39;</span><span class="p">,</span> <span class="s">&#39;bartlett&#39;</span><span class="p">,</span> <span class="s">&#39;blackman&#39;</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="s">&quot;Window is on of &#39;flat&#39;, &#39;hanning&#39;, &#39;hamming&#39;, &#39;bartlett&#39;, &#39;blackman&#39;&quot;</span>
    <span class="n">s</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">window_len</span><span class="o">-</span><span class="mi">1</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="n">window_len</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">if</span> <span class="n">window</span> <span class="o">==</span> <span class="s">&#39;flat&#39;</span><span class="p">:</span> <span class="c">#moving average</span>
      <span class="n">w</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">window_len</span><span class="p">,</span><span class="s">&#39;d&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  
      <span class="n">w</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="s">&#39;np.&#39;</span><span class="o">+</span><span class="n">window</span><span class="o">+</span><span class="s">&#39;(window_len)&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">w</span><span class="o">/</span><span class="n">w</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span><span class="n">s</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;same&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseSpectrum.baseline"><a class="viewcode-back" href="../../../api/omnifit.spectrum.BaseSpectrum.html#omnifit.spectrum.BaseSpectrum.baseline">[docs]</a>  <span class="k">def</span> <span class="nf">baseline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">degree</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">windows</span><span class="o">=</span><span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0e6</span><span class="p">]],</span><span class="n">exclusive</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">usefile</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    baseline(degree=1,windows=[[0.0,1.0e6]],exclusive=False,usefile=None)</span>

<span class="sd">    Fit and subtract a polynomial baseline from the spectrum, within</span>
<span class="sd">    the specified windows. The fitting windows can either be designated</span>
<span class="sd">    as a list of x axis coordinates, or specified interactively within</span>
<span class="sd">    a matplotlib plotting window.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    degree : `int`, optional</span>
<span class="sd">      Degree of order on the polynomial to fit.</span>
<span class="sd">    windows : `list` or `string`, optional</span>
<span class="sd">      The windows can be designated in two different ways:</span>

<span class="sd">      * as a list of x axis coordinates, e.g. </span>
<span class="sd">        [[200,250],[300,350]] for two windows</span>
<span class="sd">        of 200 to 250, and 300 to 350.</span>
<span class="sd">      * in an interactive matplotlib plotting window, by</span>
<span class="sd">        setting windows to &#39;manual&#39;</span>

<span class="sd">      In the former case, no further input is required from</span>
<span class="sd">      the user after calling baseline, but in the latter case</span>
<span class="sd">      the baseliner class is invoked from omnifit.utils.</span>
<span class="sd">    exclusive : `bool`, optional</span>
<span class="sd">      This parameter indicates whether the windows are exclusive</span>
<span class="sd">      or inclusive, i.e. whether the polynomial baseline fitting</span>
<span class="sd">      is done inside (exclusive=False) the range indicated by </span>
<span class="sd">      the windows or outside (exclusive=True) of said range.</span>
<span class="sd">    usefile : `NoneType` or `string`</span>
<span class="sd">      This parameter indicates whether an interactively designated</span>
<span class="sd">      baseline data is saved into a file, or if the baseline data</span>
<span class="sd">      is read from an already existing file.</span>
<span class="sd">      If the user wishes to use an existing file for a baseline,</span>
<span class="sd">      simply set usefile as the path to the pickle file created</span>
<span class="sd">      in a previous baselining session.</span>
<span class="sd">      To create a new baseline file, set windows to &#39;manual&#39; and</span>
<span class="sd">      set usefile to point to the desired path of the new file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">iBaseline</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">),</span><span class="n">exclusive</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">usefile</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">usefile</span><span class="p">):</span>
      <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">usefile</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">cFile</span><span class="p">:</span>
        <span class="n">windows</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">cFile</span><span class="p">)</span> 
    <span class="k">elif</span> <span class="n">windows</span><span class="o">==</span><span class="s">&#39;manual&#39;</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&#39;Determining manual baseline&#39;</span>
      <span class="n">cFig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
      <span class="n">cAx</span> <span class="o">=</span> <span class="n">cFig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
      <span class="n">cManager</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_current_fig_manager</span><span class="p">()</span>
      <span class="n">cManager</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">wm_geometry</span><span class="p">(</span><span class="s">&quot;+100+50&quot;</span><span class="p">)</span>
      <span class="n">cAx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="s">&#39;k-&#39;</span><span class="p">,</span><span class="n">drawstyle</span><span class="o">=</span><span class="s">&#39;steps-mid&#39;</span><span class="p">)</span>
      <span class="n">cBaseliner</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">Baseliner</span><span class="p">(</span><span class="n">cAx</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span><span class="s">&#39;_called_from_test&#39;</span><span class="p">):</span> <span class="c">#only show the plot if not testing</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">cFig</span><span class="p">)</span>
        <span class="n">windows</span><span class="o">=</span><span class="n">cBaseliner</span><span class="o">.</span><span class="n">windows</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cFig</span><span class="p">,</span><span class="n">cBaseliner</span> <span class="c">#send the relevant stuff back for testing</span>
      <span class="k">if</span> <span class="n">usefile</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">usefile</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">cFile</span><span class="p">:</span>
          <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">windows</span><span class="p">,</span><span class="n">cFile</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&#39;Wrote window data to &#39;</span><span class="o">+</span><span class="n">usefile</span>
    <span class="k">for</span> <span class="n">cWindow</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">exclusive</span><span class="p">:</span>
        <span class="n">iBaseline</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">iBaseline</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">cWindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">greater</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">cWindow</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">iBaseline</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">iBaseline</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">greater</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">cWindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">cWindow</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
    <span class="n">baseline</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">iBaseline</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">iBaseline</span><span class="p">],</span><span class="n">degree</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">baseline</span><span class="p">))):</span>
      <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Baseline is non-finite!&#39;</span><span class="p">)</span>
    <span class="n">fixedY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">cDegree</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">degree</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
      <span class="n">fixedY</span><span class="o">=</span><span class="n">fixedY</span><span class="o">-</span><span class="n">baseline</span><span class="p">[</span><span class="n">degree</span><span class="o">-</span><span class="n">cDegree</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="o">**</span><span class="n">cDegree</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="n">fixedY</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">unit</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">dy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">fixedY</span><span class="p">[</span><span class="n">iBaseline</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">baselined</span><span class="o">=</span><span class="bp">True</span>
</div>
<div class="viewcode-block" id="BaseSpectrum.shift"><a class="viewcode-back" href="../../../api/omnifit.spectrum.BaseSpectrum.html#omnifit.spectrum.BaseSpectrum.shift">[docs]</a>  <span class="k">def</span> <span class="nf">shift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">amount</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    shift(amount)</span>

<span class="sd">    Shifts the spectrum by amount</span>
<span class="sd">    specified, in primary x axis</span>
<span class="sd">    units.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : `float`</span>
<span class="sd">      The x axis of the entire spectrum has this number</span>
<span class="sd">      added to it, effectively shifting it.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">+=</span><span class="n">amount</span>
</div>
<div class="viewcode-block" id="BaseSpectrum.max"><a class="viewcode-back" href="../../../api/omnifit.spectrum.BaseSpectrum.html#omnifit.spectrum.BaseSpectrum.max">[docs]</a>  <span class="k">def</span> <span class="nf">max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">checkrange</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    max(checkrange=None)</span>

<span class="sd">    Returns maximum y of the spectrum.</span>
<span class="sd">    If checkrange is set, returns maximum inside of that range.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    `checkrange` : `Nonetype` or `list`</span>
<span class="sd">      If this is set to a list, the first and second items on</span>
<span class="sd">      the list are taken to indicate the range (in units of x axis)</span>
<span class="sd">      between which the maximum is looked for.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Maximum y of either the entire spectrum or, if checkrange is set,</span>
<span class="sd">    the maximum y inside of the specified range.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">iCheckrange</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">checkrange</span><span class="p">):</span>
      <span class="n">minX</span><span class="o">=</span><span class="n">checkrange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">maxX</span><span class="o">=</span><span class="n">checkrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>     
      <span class="n">iCheckrange</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">iCheckrange</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">less_equal</span><span class="p">(</span><span class="n">minX</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">greater_equal</span><span class="p">(</span><span class="n">maxX</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">iCheckrange</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="BaseSpectrum.min"><a class="viewcode-back" href="../../../api/omnifit.spectrum.BaseSpectrum.html#omnifit.spectrum.BaseSpectrum.min">[docs]</a>  <span class="k">def</span> <span class="nf">min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">checkrange</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    min(checkrange=None)</span>

<span class="sd">    Returns minimum y of the spectrum.</span>
<span class="sd">    If checkrange is set, returns minimum inside of that range.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    checkrange : `Nonetype` or `list`</span>
<span class="sd">      If this is set to a list, the first and second items on</span>
<span class="sd">      the list are taken to indicate the range (in units of x axis)</span>
<span class="sd">      between which the minimum is looked for.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Minimum y of either the entire spectrum or, if checkrange is set,</span>
<span class="sd">    the minimum y inside of the specified range.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">iCheckrange</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">checkrange</span><span class="p">):</span>
      <span class="n">minX</span><span class="o">=</span><span class="n">checkrange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">maxX</span><span class="o">=</span><span class="n">checkrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>     
      <span class="n">iCheckrange</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">iCheckrange</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">less_equal</span><span class="p">(</span><span class="n">minX</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">greater_equal</span><span class="p">(</span><span class="n">maxX</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">iCheckrange</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="BaseSpectrum.info"><a class="viewcode-back" href="../../../api/omnifit.spectrum.BaseSpectrum.html#omnifit.spectrum.BaseSpectrum.info">[docs]</a>  <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    info()</span>

<span class="sd">    Prints out a simple human-readable summary of the spectrum,</span>
<span class="sd">    containing the name of the spectrum, the units on its axes,</span>
<span class="sd">    and their limits. Also shows whether the spectrum has been</span>
<span class="sd">    baselined or convolved yet.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    None</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Nothing, but prints out a summary of the spectrum.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span> <span class="s">&#39;---&#39;</span>
    <span class="k">print</span> <span class="s">&#39;Summary for spectrum &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span>
    <span class="k">print</span> <span class="s">&#39;x unit: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;min(x): &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
    <span class="k">print</span> <span class="s">&#39;max(x): &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
    <span class="k">print</span> <span class="s">&#39;y unit: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;min(y): &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
    <span class="k">print</span> <span class="s">&#39;max(y): &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
    <span class="k">print</span> <span class="s">&#39;baselined: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baselined</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;convolved: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convolved</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;---&#39;</span>
</div></div>
<div class="viewcode-block" id="AbsorptionSpectrum"><a class="viewcode-back" href="../../../api/omnifit.spectrum.AbsorptionSpectrum.html#omnifit.spectrum.AbsorptionSpectrum">[docs]</a><span class="k">class</span> <span class="nc">AbsorptionSpectrum</span><span class="p">(</span><span class="n">BaseSpectrum</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  A class specialized in representing absorption spectra of the type</span>
<span class="sd">  often used in ice spectroscopy.</span>

<span class="sd">  The functionality of this class is otherwise identical to `BaseSpectrum`,</span>
<span class="sd">  except it contains an additional method for plotting the optical depth</span>
<span class="sd">  spectrum in either microns and kayser units, both of which it stores</span>
<span class="sd">  as additional attributes. Upon initialisation it uses the kayser units</span>
<span class="sd">  as its x axis units.</span>

<span class="sd">  Attributes</span>
<span class="sd">  -----------</span>
<span class="sd">  All the attributes stored in `BaseSpectrum`, plus the following:</span>
<span class="sd">  wn : `astropy.units.Quantity`</span>
<span class="sd">    The data on the x-axis of the spectrum, expressed in kayser</span>
<span class="sd">    (reciprocal wavenumber) units.</span>
<span class="sd">  wl : `astropy.units.Quantity`</span>
<span class="sd">    The data on the x-axis of the spectrum, expressed in microns.</span>
<span class="sd">  od : `astropy.units.Quantity`</span>
<span class="sd">    The data on the y-axis spectrum, expressed as optical depth</span>
<span class="sd">    units (using omnifit.utils.unit_od).</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wn</span><span class="p">,</span><span class="n">od</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    AbsorptionSpectrum(wn,od,**kwargs)</span>

<span class="sd">    Constructor for the `AbsorptionSpectrum` class.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wn : `astropy.units.Quantity`</span>
<span class="sd">      The absorption spectrum frequency data. Unlike `BaseSpectrum`,</span>
<span class="sd">      the initialisation of `AbsorptionSpectrum` requires this to be</span>
<span class="sd">      in the specific units of reciprocal wavenumber. However, if it is</span>
<span class="sd">      in a quantity convertable to kayser, conversion will be attempted</span>
<span class="sd">      while a warning is given to notify the user of this.</span>
<span class="sd">    od : `astropy.units.Quantity`</span>
<span class="sd">      The absorption spectrum optical depth data. Unlike `BaseSpectrum`,</span>
<span class="sd">      the initialisation of `AbsorptionSpectrum` requires this to be</span>
<span class="sd">      in the specific units of optical depth units (from</span>
<span class="sd">      `omnifit.utils.unit_od`).</span>
<span class="sd">    **kwargs : Arguments, optional</span>
<span class="sd">      Additional initialisation arguments can be passed to `BaseSpectrum`</span>
<span class="sd">      using this. Note that x and y are defined using the other</span>
<span class="sd">      initialisation parameters of `AbsorptionSpectrum`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">wn</span><span class="p">)</span> <span class="o">!=</span> <span class="n">u</span><span class="o">.</span><span class="n">quantity</span><span class="o">.</span><span class="n">Quantity</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">u</span><span class="o">.</span><span class="n">UnitsError</span><span class="p">(</span><span class="s">&#39;Input wn is not an astropy quantity.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wn</span><span class="o">.</span><span class="n">unit</span> <span class="o">!=</span> <span class="n">u</span><span class="o">.</span><span class="n">kayser</span><span class="p">:</span>
      <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&#39;Input wn is not in kayser units. Converting...&#39;</span><span class="p">,</span><span class="ne">RuntimeWarning</span><span class="p">)</span>
      <span class="k">with</span> <span class="n">u</span><span class="o">.</span><span class="n">set_enabled_equivalencies</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">equivalencies</span><span class="o">.</span><span class="n">spectral</span><span class="p">()):</span>
        <span class="n">wn</span><span class="o">=</span><span class="n">wn</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">kayser</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">od</span><span class="p">)</span> <span class="o">!=</span> <span class="n">u</span><span class="o">.</span><span class="n">quantity</span><span class="o">.</span><span class="n">Quantity</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">u</span><span class="o">.</span><span class="n">UnitsError</span><span class="p">(</span><span class="s">&#39;Input od is not an astropy quantity.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">od</span><span class="o">.</span><span class="n">unit</span> <span class="o">!=</span> <span class="n">utils</span><span class="o">.</span><span class="n">unit_od</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">u</span><span class="o">.</span><span class="n">UnitsError</span><span class="p">(</span><span class="s">&#39;Input od is not in optical depth units.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wn</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">od</span><span class="p">):</span>
      <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Input arrays have different sizes.&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">wn</span> <span class="o">=</span> <span class="n">wn</span>
    <span class="k">with</span> <span class="n">u</span><span class="o">.</span><span class="n">set_enabled_equivalencies</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">equivalencies</span><span class="o">.</span><span class="n">spectral</span><span class="p">()):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">wl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wn</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">micron</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">od</span> <span class="o">=</span> <span class="n">od</span>
    <span class="n">BaseSpectrum</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wn</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">od</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<div class="viewcode-block" id="AbsorptionSpectrum.plotod"><a class="viewcode-back" href="../../../api/omnifit.spectrum.AbsorptionSpectrum.html#omnifit.spectrum.AbsorptionSpectrum.plotod">[docs]</a>  <span class="k">def</span> <span class="nf">plotod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span><span class="n">in_wl</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plotod(ax,in_wl=False,**kwargs)</span>

<span class="sd">    Plot the optical depth spectrum as either a function of reciprocal</span>
<span class="sd">    wavenumber or wavelength to the given axis.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    axis : `matplotlib.axis`</span>
<span class="sd">      The axis which the plot will be generated in.</span>
<span class="sd">    in_wl : `bool`, optional</span>
<span class="sd">      If set to true, the x axis of the plotting axis will be in</span>
<span class="sd">      wavelength; otherwise it will be in reciprocal wavenumbers.</span>
<span class="sd">    **kwargs : Arguments, optional</span>
<span class="sd">      This can be used to pass additional arguments</span>
<span class="sd">      to `matplotlib.pyplot.plot`, which is used by this </span>
<span class="sd">      method for its plotting.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">in_wl</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="s">&#39;wl&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s">&#39;od&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>      
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="s">&#39;wn&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s">&#39;od&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="CDESpectrum"><a class="viewcode-back" href="../../../api/omnifit.spectrum.CDESpectrum.html#omnifit.spectrum.CDESpectrum">[docs]</a><span class="k">class</span> <span class="nc">CDESpectrum</span><span class="p">(</span><span class="n">AbsorptionSpectrum</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  A class specialized in representing CDE-corrected absorption spectra.</span>

<span class="sd">  The functionality of this class is otherwise identical to</span>
<span class="sd">  `AbsorptionSpectrum` (and by extension, `BaseSpectrum`), except it</span>
<span class="sd">  contains an additional method for plotting the complex refractive index</span>
<span class="sd">  data, which it also stores in additional attributes as part of the class</span>
<span class="sd">  instance. Also stored are various additional data returned by the CDE</span>
<span class="sd">  correction, as documented below.</span>

<span class="sd">  Attributes</span>
<span class="sd">  -----------</span>
<span class="sd">  All the attributes stored in `AbsorptionSpectrum`, plus the following:</span>
<span class="sd">  n : `numpy.ndarray`</span>
<span class="sd">    The real part of the complex refractive index spectrum of the data.</span>
<span class="sd">  k : `numpy.ndarray`</span>
<span class="sd">    The imaginary part of the complex refractive index spectrum of the</span>
<span class="sd">    data.</span>
<span class="sd">  cabs : `numpy.ndarray`</span>
<span class="sd">    The spectrum of the absorption cross section of the simulated grain.</span>
<span class="sd">  cabs_vol : `numpy.ndarray`</span>
<span class="sd">    The spectrum of the absorption cross section of the simulated grain,</span>
<span class="sd">    normalized by the volume distribution of the grain. This parameter</span>
<span class="sd">    is the equivalent of optical depth in most cases.</span>
<span class="sd">  cscat_vol : `numpy.ndarray`</span>
<span class="sd">    The spectrum of the scattering cross section of the simulated grain,</span>
<span class="sd">    normalized by the volume distribution of the grain.</span>
<span class="sd">  ctot : `numpy.ndarray`</span>
<span class="sd">    The spectrum of the total cross section of the simulated grain.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wn</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CDESpectrum(wn,n,k,**kwargs)</span>

<span class="sd">    Constructor for the `CDESpectrum` class.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wn : `astropy.units.Quantity` or `numpy.ndarray`</span>
<span class="sd">      The absorption spectrum frequency data. If given as</span>
<span class="sd">      `astropy.units.Quantity`, they must either be in kayser (reciprocal</span>
<span class="sd">      wavenumbers) or convertable to kayser. If given as `numpy.ndarray`,</span>
<span class="sd">      they are assumed to be in kayser.</span>
<span class="sd">    n : `numpy.ndarray`</span>
<span class="sd">      The real part of the complex refractive index spectrum of the data.</span>
<span class="sd">    k : `numpy.ndarray`</span>
<span class="sd">      The imaginary part of the complex refractive index spectrum of the</span>
<span class="sd">      data.</span>
<span class="sd">    **kwargs : Arguments, optional</span>
<span class="sd">      Additional initialisation arguments can be passed to</span>
<span class="sd">      `AbsorptionSpectrum` using this. Note that x and y are defined using</span>
<span class="sd">      the other initialisation parameters of `CDESpectrum`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wn</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
      <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Input arrays have different sizes.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">wn</span><span class="p">)</span> <span class="o">!=</span> <span class="n">u</span><span class="o">.</span><span class="n">quantity</span><span class="o">.</span><span class="n">Quantity</span><span class="p">:</span>
      <span class="n">wn</span> <span class="o">=</span> <span class="n">wn</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kayser</span>
    <span class="k">if</span> <span class="n">wn</span><span class="o">.</span><span class="n">unit</span> <span class="o">!=</span> <span class="n">u</span><span class="o">.</span><span class="n">kayser</span><span class="p">:</span>
      <span class="k">with</span> <span class="n">u</span><span class="o">.</span><span class="n">set_enabled_equivalencies</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">equivalencies</span><span class="o">.</span><span class="n">spectral</span><span class="p">()):</span>
        <span class="n">wn</span><span class="o">=</span><span class="n">wn</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">kayser</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cabs</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">cabs_vol</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">cscat_vol</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ctot</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">cde_correct</span><span class="p">(</span><span class="n">wn</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s">&#39;float64&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">AbsorptionSpectrum</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wn</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">cabs_vol</span><span class="o">*</span><span class="n">utils</span><span class="o">.</span><span class="n">unit_od</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<div class="viewcode-block" id="CDESpectrum.plotnk"><a class="viewcode-back" href="../../../api/omnifit.spectrum.CDESpectrum.html#omnifit.spectrum.CDESpectrum.plotnk">[docs]</a>  <span class="k">def</span> <span class="nf">plotnk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax_n</span><span class="p">,</span><span class="n">ax_k</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plotnk(ax_n,ax_k,**kwargs)</span>
<span class="sd">    </span>
<span class="sd">    Plot the complex refractive indices as function of wavenumber to</span>
<span class="sd">    the two given matplotlib axes.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ax_n : `matplotlib.axis`</span>
<span class="sd">      The axis which the plot of n will be generated in.</span>
<span class="sd">    ax_k : `matplotlib.axis`</span>
<span class="sd">      The axis which the plot of k will be generated in.</span>
<span class="sd">    **kwargs : Arguments, optional</span>
<span class="sd">      This can be used to pass additional arguments</span>
<span class="sd">      to `matplotlib.pyplot.plot`, which is used by this </span>
<span class="sd">      method for its plotting.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ax_n</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wn</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">ax_k</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wn</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right"> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2015, Aleksi Suutarinen.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1. &nbsp;
    Last built 24 Aug 2015. <br/>
  </p>
</footer>
  </body>
</html>